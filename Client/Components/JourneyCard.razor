@using Shared.Models;
@using Shared.Models.Dtos.Journeys
@using Shared.Models.enums

<div class="journey-card">
    <div class="card-header">
        <span class="card-title">
            @(Journey.OwnerId == CurrentUserId ? "Mijn reis" : $"Reis van {Journey.OwnerName}")
        </span>
    </div>
    <div class="row">
        <div class="icon"><img src="/icons/journey/calendar-24.png" /></div>
        <div class="content">@Journey.StartAt.ToLocalTime().ToString("dddd dd MMMM yyyy")</div>
    </div>
    <div class="divider"></div>

    <div class="row">
        <div class="icon"><img src="/icons/journey/clock-24.png" /></div>
        <div class="content">@Journey.StartAt.ToLocalTime().ToString("HH:mm")h</div>
    </div>
    <div class="divider"></div>

    <div class="row">
        <div class="icon"><img src="/icons/journey/from-24.png" /></div>
        <div class="content">Van @FormatPlace(Journey.Start!)</div>
    </div>
    <div class="divider"></div>

    <div class="row">
        <div class="icon"><img src="/icons/journey/to-24.png" /></div>
        <div class="content">Naar @FormatPlace(Journey.End!)</div>
    </div>

    <div class="buddy-row">
        Reisbuddies:
        @foreach (var buddy in Journey.Participants
                .Where(p => p.UserId != CurrentUserId && p.Status == RequestStatus.Accepted))
        {
            <span class="buddy-tag">@buddy.UserName</span>
        }
    </div>

    @if (JourneyCardButtons is not null)
    {
        <div class="card-actions">
            @JourneyCardButtons
        </div>
    }
</div>

@code {
    [Parameter] public JourneyDto Journey { get; set; } = default!;
    [Parameter] public int CurrentUserId { get; set; }
    [Parameter] public RenderFragment? JourneyCardButtons { get; set; }

    private string FormatPlace(PlaceDto place)
    {
        if (place.District == null)
            return place.City;
        return $"{place.City}, {place.District}";
    }
}
